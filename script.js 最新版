
// 仮のデータ蓄積カウンター（実際にはサーバーやローカルストレージから取得）
let monthlyDataCount = 0;
const REQUIRED_MONTHS = 12; // 分析に必要な月数


function parseToNumber(value) {
  let str = String(value || "");
 str = str.replace(/[０-９]/g, s => String.fromCharCode(s.charCodeAt(0) - 65248)); 
  const numStr = str.replace(/[^0-9]/g, "");
  return Number(numStr) || 0; 
}


function updateDataAndChart() {
  // 入力値の取得
  const food = parseToNumber(document.getElementById("food").value);
  const transport = parseToNumber(document.getElementById("transport").value);
  const hobby = parseToNumber(document.getElementById("hobby").value);  
  const other = parseToNumber(document.getElementById("other").value);

  //合計金額の計算と表示
  const total = food + transport + hobby + other;
  document.getElementById("total").textContent = total.toLocaleString();


  //グラフデータの更新と再描画
  myChart.data.datasets[0].data = [food, transport, hobby, other];
  myChart.update();

  // 【分析結果の表示制御ロジック】

  monthlyDataCount++; // データが１ヶ月分増えたと仮定（テスト用）

  const warningElement = document.getElementById("warningMessage");
  const analysisLabel = document.getElementById("analysisLabel");

  if (monthlyDataCount >= REQUIRED_MONTHS) {
      // **データが揃った場合** 
      warningElement.style.display = 'none'; // 警告を非表示
      analysisLabel.classList.remove('disabled-analysis'); // グレーを解除
      analysisLabel.classList.add('enabled-analysis'); // 赤色を適用し、クリック可能に
  } else {
      // **データが不足している場合** 
      warningElement.style.display = 'block'; // 警告を表示（ブロック要素として）
      analysisLabel.classList.remove('enabled-analysis');
      analysisLabel.classList.add('disabled-analysis'); // グレーを適用し、クリック不可に
  }
}


window.onload = function() {
// 入力フィールドの初期化
  document.getElementById("food").value = "";
  document.getElementById("transport").value = "";
  document.getElementById("hobby").value = "";
  document.getElementById("other").value = "";
  document.getElementById("total").textContent = "0";

  const ctx = document.getElementById("myChart").getContext("2d");
  myChart = new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["食費", "交通費", "趣味", "その他"],
      datasets: [{
        data: [1,1,1,1], //初期データ
        backgroundColor: [ "#66b3ff", "#99ff99", "#ffcc66", "#ff6666"]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      Plugins: {
        legend: {
          position: 'bottom',
          labels: {
            font: {
            size: 14
            }
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.parsed;
              return '${label}: ${value.toLocaleString()}円';
            }

          }
        }
      }
    }
  });
  const calculateBtn = document.getElementById('calculateBtn');
if (calculateBtn) {
  calculateBtn.addEventListener('click', updateDataAndChart);
}

const analysisLabel =this.document.getElementById('analysisLabel');
if (analysisLabel) {
  analysisLabel.addEventListener('click', function() {
    if (monthlyDataCount >= REQUIRED_MONTHS) {
      alert("分析結果を表示します！ (ここに分析結果表示を記述）");
    } else {
      console.log("データ不足のため、分析は実行できません。");
    }
  });
 }
};

