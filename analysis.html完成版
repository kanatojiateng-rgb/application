<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>分析・シミュレーション結果</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<div class="report-container">
<h1>節約投資分析レポート</h1>

<div class="chart-container">

<div class="chart-box">
<h2>① 過去12ヵ月の支出推移</h2>
<div class="summary-text">月ごとの支出合計の推移です。</div>
<div class="canvas-container">
<canvas id="expenseLineChart"></canvas>
</div>
</div>

<div class="chart-box">
<h2>② 将来の資産形成シミュレーション</h2>
<div class="summary-text">平均的な節約額を投資に回し、年利5%で運用できた場合の20年間の予測です。</div>
<div class="canvas-container">
<canvas id="investmentChart"></canvas>
</div>
</div>
</div>

</div>
</div>


<div class="analysis-section">
  <h2>③ AIによる詳細分析</h2>

  <div class="metrics-grid">
    <div class="metrics-card">
      <span class="metric-label">平均月間支出</span>
      <span id="avg_expense_display" class="metric-value">{{avg_expense_display }}</span></div>
    
      <div class="metrics-card">
        <span class="metric-label">前月比</span>
        <span class="metrics-value  {{'status-up' if monthly_ratio <= 0 else 'status-down'}}">
          {{ '▲' if monthly_ratio <= 0 else '▼' }} {{ monthly_ratio|abs }}%
        </span>
      </div>

    <div class="metrics-card">
      <span class="metric-label">年間節約総額</span>
      <span class="metric-value">{{ annual_savings }}円</span></div>
  </div>


  <div class="analysis-card">
    <h3>支出傾向のアドバイス</h3>

    <p class="analysis-text">
      {{ advice }}
    </p>
  </div>
</div>

<style>
body {
  background-color: lightcyan;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
  padding: 40px;
}

.chart-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 180px;
  max-width: 1200px;
}

.chart-box {
  flex: 1;
  min-width: 450px;
  max-width: 600px;
  padding: 15px;
  border-radius: 12px;
}

.canvas-container {
  position: relative;
  height: 300px;
  width: 100%;
}

.report-container h1 {
  color: plum;
  text-align: center;
  font-size: 50px;
}

.chart-box h2 {
  color: pink;
}

.summary-text {
  color: peru;
}

.analysis-section {
  width:100%;
  max-width: 1100px;
  margin-top: 40px;
}

/*メトリクス（数字）の横並び */
.metrics-grid {
  display: flex;
  gap: 20px;
  margin-bottom: 30px;
}

.metrics-card {
  flex: 1;
  padding: 20px;
  border-radius: 15px;
  text-align: center;
}

.metric-label {
  display: block;
  color: peru;
  font-size: 16px;
  margin-bottom: 8px;                              
  font-weight: 600;
}

.metric-value {
  font-size: 24px;
  font-weight: bold;
  color: gray;
  display: block;
  margin-top: 5px;
}

/* 支出が減った（良い傾向）ときの色 */
.status-down {
  color: green;
  font-size: 25px;
}

.status-up {
  color: red;
  font-size: 25px;
}
/* 分析カード */
.analysis-card {
    padding: 30px;
    border-radius: 20px;
    border-left: 10px solid plum;
}

.analysis-card h3 {
  color: pink;
  margin-top: 0;
}

.analysis-text {
   line-height: 2.0;
   font-size: 18px;
   color: #444;
}

.metric-card, .analysis-card {
  background-color: white;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.analysis-section h2 {
  color: pink;
}
</style>

<script>
    const chartDataFromServer = {
        labels: {{ labels | safe }},
        totals: {{ totals | safe  }},
        sim_data: {{ sim_data | safe }}
    };
    console.log("Data loaded:", chartDataFromServer);
</script>

<script src="{{ url_for('static', filename='script_analysis.js') }}"></script>

</body>
</html> 
